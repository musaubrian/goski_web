<div class=\"w-full bg-green-50/50 flex flex-col justify-center items-center text-slate-950 tracking-tight\"><form id=\"ascii-form\" class=\"flex flex-col justify-center items-center w-full h-screen text-lg font-light\" method=\"POST\" action=\"/to-ascii\" enctype=\"multipart/form-data\"><h1 class=\"text-4xl font-semibold mb-6 text-center text-wrap text-balance\">Image > ASCII Generator</h1><label id=\"upload-label\" for=\"file-upload\" class=\"cursor-pointer w-4/6 h-52 bg-slate-50 hover:bg-slate-100 transition-all border-2 rounded-lg p-3 flex flex-col justify-center items-center\"><div id=\"upload-text\" class=\"font-light text-center\">Select Image to convert</div><img id=\"uploaded-image\" class=\"hidden max-h-full max-w-full object-contain rounded-lg\" alt=\"Uploaded image preview\"> <input id=\"file-upload\" type=\"file\" name=\"image\" class=\"hidden\"></label> <button type=\"submit\" class=\"mt-6 bg-slate-900 text-white px-6 py-2 rounded hover:bg-slate-700 transition-all\">Convert</button></form><div class=\"flex flex-col justify-center items-center min-h-screen w-full mt-8\"><div class=\"w-full h-screen overflow-auto bg-slate-100 text-center\"><pre id=\"ascii-output\" class=\"whitespace-pre font-mono text-[4px]\"></pre></div></div></div><script>\n            function resetSuccess() {\n                const currentUrl = new URL(window.location.href);\n                currentUrl.searchParams.delete('success');\n                window.history.replaceState({}, '', currentUrl);\n            }\n\n        function resetErr(){\n            const currentUrl = new URL(window.location.href);\n            currentUrl.searchParams.delete('error');\n            window.history.replaceState({}, '', currentUrl);\n        }\n        function getViewportSize() {\n            return {\n                width: Math.round(window.innerWidth *0.5),\n                height: Math.round(window.innerHeight*0.5)\n            };\n        }\n\n\n        document.getElementById('file-upload').addEventListener('change', function(event) {\n                const file = event.target.files[0];\n                const uploadLabel = document.getElementById('upload-label');\n                const uploadText = document.getElementById('upload-text');\n                const uploadedImage = document.getElementById('uploaded-image');\n\n                if (file) {\n                resetErr()\n                const reader = new FileReader();\n                reader.onload = function(e) {\n                uploadText.classList.add('hidden');\n                uploadedImage.src = e.target.result;\n                uploadedImage.classList.remove('hidden');\n                uploadLabel.classList.remove('bg-slate-50', 'border-2', 'hover:bg-slate-100');\n                uploadLabel.classList.add('p-0');\n                };\n                reader.readAsDataURL(file);\n                }\n                });\n\n        document.getElementById('ascii-form').addEventListener('submit', async function(event) {\n                event.preventDefault();\n\n                const fileInput = document.getElementById('file-upload');\n\n                if (!fileInput.files.length) {\n                const errorMsg = \"Nothing to upload\";\n                const currentUrl = new URL(window.location.href);\n                currentUrl.searchParams.set('error', errorMsg);\n                window.location.href = currentUrl;\n                return\n                }\n\n                const form = event.target;\n                const formData = new FormData(form);\n                let viewportSize = getViewportSize();\n\n                formData.append('viewportWidth', viewportSize.width);\n                formData.append('viewportHeight', viewportSize.height);\n\n\n                try {\n                const response = await fetch(form.action, {\nmethod: form.method,\nbody: formData,\n});\n\nconst data = await response.json();\nif (response.ok) {\n    if (data.ascii) {\n        document.getElementById('ascii-output').textContent = data.ascii;\n    }\n} else if(data.error) {\n    const currentUrl = new URL(window.location.href);\n    currentUrl.searchParams.set('error', encodeURIComponent(data.error));\n    window.history.replaceState({}, '', currentUrl);\n}\n} catch (error) {\n    console.error('Error processing the request:', error);\n    const errorMsg = \"Something went wrong\";\n    const currentUrl = new URL(window.location.href);\n    currentUrl.searchParams.set('error', errorMsg);\n    window.history.replaceState({}, '', currentUrl);\n}\n});\n</script>
